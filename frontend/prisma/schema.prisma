generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model news {
  id             Int             @id @default(autoincrement())
  news_id        String          @unique(map: "ix_news_news_id") @db.VarChar
  news_url       String          @db.VarChar
  thum_url       String?         @db.VarChar
  broadcast_date DateTime        @db.Timestamp(6)
  category       String?         @db.VarChar
  news_english   news_english[]
  news_korean    news_korean[]
  comments       comment[]
  llm_translate  llm_translate[]

  @@index([id], map: "ix_news_id")
}

model news_english {
  id       Int    @id @default(autoincrement())
  news_id  String @db.VarChar
  language String @db.VarChar
  title    String
  content  String
  news     news   @relation(fields: [news_id], references: [news_id], onDelete: NoAction, onUpdate: NoAction)

  @@index([id], map: "ix_news_english_id")
  @@index([news_id], map: "ix_news_english_news_id")
}

model news_korean {
  id       Int    @id @default(autoincrement())
  news_id  String @db.VarChar
  language String @db.VarChar
  title    String
  content  String
  news     news   @relation(fields: [news_id], references: [news_id], onDelete: NoAction, onUpdate: NoAction)

  @@index([id], map: "ix_news_korean_id")
  @@index([news_id], map: "ix_news_korean_news_id")
}

model llm_translate {
  id      Int    @id @default(autoincrement())
  news_id String @db.VarChar
  english String
  korean  String
  news    news   @relation(fields: [news_id], references: [news_id], onDelete: NoAction, onUpdate: NoAction)

  @@index([id], map: "ix_llm_translate_id")
  @@index([news_id], map: "ix_llm_trnaslate_news_id")
}

model comment {
  id        Int       @id @default(autoincrement())
  news_id   String    @db.VarChar
  parentId  Int?
  content   String // 댓글 내용
  userId    Int? // 댓글 작성자 (옵션)
  createdAt DateTime  @default(now()) // 댓글 작성 시간
  updatedAt DateTime  @default(now()) @updatedAt
  parent    comment?  @relation("CommentToParent", fields: [parentId], references: [id], onDelete: Cascade) // 부모 댓글과의 관계
  children  comment[] @relation("CommentToParent") // 대댓글 (자식 댓글들)
  news      news      @relation(fields: [news_id], references: [news_id], onDelete: Cascade, onUpdate: Cascade) // 뉴스와의 관계
  user      user?     @relation(fields: [userId], references: [id], onDelete: SetNull) // 사용자와의 관계 (옵션)

  @@index([id], map: "ix_comment_id")
  @@index([news_id], map: "ix_comment_news_id")
  @@index([userId], map: "ix_comment_user_id")
}

model user {
  id             Int             @id @default(autoincrement())
  providerId     String          @db.VarChar
  email          String?         @unique
  name           String?
  profilePicture String?         @db.VarChar
  oauthAccount   o_auth_account? @relation("UserToOAuthAccount")
  comments       comment[]
  boardComments  board_comment[] // 추가: 작성한 게시판 댓글
  posts          post[]          @relation("UserToPost")
  createdAt      DateTime        @default(now())
  updatedAt      DateTime        @updatedAt
}

model o_auth_account {
  id           Int      @id @default(autoincrement()) // 기본 키
  provider     String // OAuth 제공자 이름 (e.g., "google", "facebook")
  providerId   String   @unique // 제공자별 사용자 고유 ID
  accessToken  String   @db.VarChar
  refreshToken String?  @db.VarChar // 초기 발급 시 저장
  expiresAt    DateTime // Access Token 만료 시간
  scope        String?  @db.VarChar // 권한 범위
  tokenType    String   @db.VarChar
  user         user?    @relation("UserToOAuthAccount", fields: [userId], references: [id], onDelete: Cascade) // 관계 이름 + 필드와 참조
  userId       Int?     @unique // 사용자와 1:1 관계를 보장
}

model board {
  id          Int      @id @default(autoincrement())
  name        String   @unique @db.VarChar // 게시판 이름 (e.g., 자유게시판)
  code        String   @db.VarChar
  description String?  @db.VarChar // 게시판 설명
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  posts       post[]
}

model post {
  id        Int             @id @default(autoincrement())
  boardId   Int
  title     String          @db.VarChar
  content   String
  userId    Int? // 작성자 ID (익명 허용)
  createdAt DateTime        @default(now())
  updatedAt DateTime        @updatedAt
  board     board           @relation(fields: [boardId], references: [id], onDelete: Cascade)
  author    user?           @relation("UserToPost", fields: [userId], references: [id], onDelete: SetNull) // 수정: 관계 이름 추가
  comments  board_comment[]
}

model board_comment {
  id        Int             @id @default(autoincrement())
  postId    Int
  parentId  Int? // 부모 댓글 ID
  content   String
  userId    Int? // 작성자 ID (익명 허용)
  createdAt DateTime        @default(now())
  updatedAt DateTime        @updatedAt
  post      post            @relation(fields: [postId], references: [id], onDelete: Cascade)
  parent    board_comment?  @relation("CommentToParent", fields: [parentId], references: [id], onDelete: Cascade)
  children  board_comment[] @relation("CommentToParent") // 부모 댓글이 가진 자식 댓글들
  user      user?           @relation(fields: [userId], references: [id], onDelete: SetNull)
}
